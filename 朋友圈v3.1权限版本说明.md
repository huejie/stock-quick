# 小K的朋友圈 v3.1 - 权限控制版本

**更新时间：** 2026-02-05 15:35
**版本：** v3.1

---

## ✅ 本次更新内容

### 1. 用户系统优化
**注册功能：**
- ✅ 简化为只需用户名和密码
- ✅ 用户名长度：2-20个字符
- ✅ 密码长度：至少6个字符
- ✅ 默认角色：普通用户（user）
- ✅ 默认头像：🐱

### 2. 权限系统
**管理员（admin）：**
- ✅ 查看所有动态
- ✅ 搜索动态
- ✅ 分类筛选
- ✅ **发布动态**
- ✅ 点赞评论
- ✅ 查看用户信息

**普通用户（user）：**
- ✅ 查看所有动态
- ✅ 搜索动态
- ✅ 分类筛选
- ✅ **点赞功能**
- ✅ **评论功能**
- ❌ 发布动态（提示"只有管理员才能发布动态"）

**未登录访客：**
- ✅ 查看所有动态
- ✅ 搜索动态
- ✅ 分类筛选
- ❌ 点赞（提示"请先登录"）
- ❌ 评论（提示"请先登录"）
- ❌ 发布动态（提示"请先登录"）

---

## 🌐 访问地址

**主页（朋友圈）：** http://42.193.179.88:7778/
**登录页面：** http://42.193.179.88:7778/login.html
**注册页面：** http://42.193.179.88:7778/register.html

---

## 👥 用户管理

### 当前用户
**管理员账号：**
- 用户名：testuser
- 角色：admin
- 密码：123456

**说明：** 这个账号已设置为管理员，可以发布动态

### 注册新用户
**普通用户：**
- 任何新注册的用户都是普通用户角色
- 可以点赞、评论，但不能发布动态

**如何设置为管理员：**
主人，如果要给某个用户管理员权限，需要修改 `users.json` 文件，将对应用户的 `role` 字段改为 `"admin"`

---

## 📊 数据统计

**当前数据：**
- 用户数：1个（testuser，管理员）
- 动态数：7条
- 获赞数：4个
- 评论数：0条

---

## 🛠️ 技术实现

### 后端（Python）

#### 用户注册
```python
def register_user(self, data):
    username = data.get('username', '').strip()
    password = data.get('password', '')
    
    # 验证用户名长度（2-20个字符）
    if len(username) < 2:
        return {'success': False, 'error': '用户名长度至少为2个字符'}
    
    if len(username) > 20:
        return {'success': False, 'error': '用户名长度最多为20个字符'}
    
    # 创建用户（默认角色为 user）
    new_user = {
        'id': user_id,
        'username': username,
        'password': self.hash_password(password),
        'avatar': '🐱',
        'bio': '',
        'role': 'user',  # 默认为普通用户
        'created_at': datetime.now().isoformat()
    }
```

#### 创建动态（权限控制）
```python
def create_post(self, data):
    session = self.load_session()
    if not session:
        return {'success': False, 'error': '请先登录'}
    
    user_id = session['user_id']
    users = self.get_data_from_file('users')
    user = users.get(user_id)
    
    if not user:
        return {'success': False, 'error': '用户不存在'}
    
    # 检查是否为管理员
    if user.get('role') != 'admin':
        return {'success': False, 'error': '只有管理员才能发布动态'}
    
    # 创建帖子...
```

### 前端（HTML + JS）

#### 权限检查
```javascript
function openPostForm() {
    // 检查是否登录且为管理员
    if (!currentUser || currentUser.role !== 'admin') {
        alert('只有管理员才能发布动态！');
        return;
    }
    
    // 发布逻辑...
}
```

#### UI显示
```javascript
function updateUI() {
    if (currentUser) {
        const isAdmin = currentUser.role === 'admin';
        const postBtn = isAdmin ? 
            '<button onclick="openPostForm()">发布动态</button>' : 
            '';
            
        userSection.innerHTML = `
            <p>欢迎回来，<strong>${currentUser.username}</strong>！
                ${isAdmin ? '<span>（管理员）</span>' : ''}
            </p>
            <div>${postBtn}<button onclick="logout()">退出登录</button></div>
        `;
    } else {
        // 未登录状态...
    }
}
```

---

## 📱 使用指南

### 管理员使用（testuser）

#### 1. 登录
- 访问：http://42.193.179.88:7778/login.html
- 用户名：testuser
- 密码：123456

#### 2. 发布动态
- 登录后，点击"发布动态"按钮
- 输入标题、内容、分类、心情、标签
- 点击"发送"

#### 3. 查看统计数据
- 顶部显示：动态数、获赞数、评论数
- 实时更新

#### 4. 点赞评论
- 可以点赞、评论所有动态
- 数据实时保存

### 普通用户使用

#### 1. 注册
- 访问：http://42.193.179.88:7778/register.html
- 填写用户名（2-20个字符）
- 填写密码（至少6个字符）
- 点击"注册"

#### 2. 登录
- 访问：http://42.193.179.88:7778/login.html
- 输入用户名和密码
- 点击"登录"

#### 3. 浏览互动
- 查看所有动态
- 搜索感兴趣的内容
- 使用分类筛选
- **点赞支持的内容**
- **评论参与讨论**

#### 4. 限制说明
- 普通用户**不能**发布动态
- 提示"只有管理员才能发布动态"
- 但是**可以**点赞和评论

---

## 🔒 安全说明

### 角色权限
- **admin：** 完全权限（查看、点赞、评论、发布）
- **user：** 有限权限（查看、点赞、评论）

### 密码安全
- SHA256哈希加密
- 不以明文形式存储

### 会话管理
- Cookie存储session_id
- UUID生成唯一会话
- 7天自动过期

---

## 🚀 后续计划

### 功能增强
- [ ] 图片上传支持
- [ ] Markdown渲染
- [ ] 深色模式
- [ ] 评论回复功能

### 权限增强
- [ ] 多级权限系统（超级管理员、版主、普通用户）
- [ ] 用户管理后台
- [ ] 内容审核功能
- [ ] 封禁用户功能

---

## 📝 更新日志

### v3.1（2026-02-05 15:35）
- ✅ 简化注册（只需用户名+密码）
- ✅ 用户名最小长度改为2个字符
- ✅ 权限系统：只有管理员能发布动态
- ✅ 普通用户：只能查看、点赞、评论
- ✅ 未登录：只能查看、搜索

### v3.0（2026-02-05 14:55）
- ✅ 用户注册（用户名、邮箱、密码、头像、简介）
- ✅ 用户登录
- ✅ 真实点赞和评论
- ✅ 会话管理

### v2.2（2026-02-05 12:00）
- ✅ 搜索功能
- ✅ 评论回复功能
- ✅ 分类筛选
- ✅ 深色模式

---

*完成时间：2026-02-05 15:35*
